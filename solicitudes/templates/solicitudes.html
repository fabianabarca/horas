{% extends 'base.html' %} {% load crispy_forms_tags %} {% block main %}  {% load static %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


<div class="container">
</br>
  <h1>Gestiones Administrativas</h1>
 
  <a href="crear_solicitud" class="btn btn-info" role="button">Crear Gestion</a>
  <button type="button" class="btn btn-info" onclick="esconderFiltros()">Ver Filtros</button>
  {% if solicitudes %}
  <button type="button" class="btn btn-info" onclick="checkAll()">Seleccionar Todas</button>
  <button type="button" class="btn btn-info" onclick="uncheckAll()">Limpiar</button>

  {% endif %}
</br>
</br>
<div id="filtrosdiv" style = 'display: none;'>
<form method="post">
  {% csrf_token %}
  <input type="hidden" name="next" value="{{ next }}" />

 
  <div class="row">
  {% for field in filtros_form  %}
    <div class="col-sm-4">
      <b>{{ field.label_tag }}</b> - {{ field}} 
    </br>

    </div>
</br>
  {% endfor %}

 
  </div>  
  <button type="submit" style = 'width: 200px; height:40px;' class="btn btn-primary btn-block">Filtrar</button>
 

  
</form>
</br>
</div>


  {% if solicitudes %}
  <form method="post">
    {% csrf_token %}
    {% if request.user.is_staff %}
    <input type="submit" class="btn btn-success" value="Aprobar" name="aprobar">
    <input type="submit" class="btn btn-danger " value="Rechazar" name="rechazar">
    {% endif %}

  </br>
  </br>
  <div class="table-responsive">
    <table id = "datatable" class="table table-striped table-bordered">
    <thead class="thead">
      <tr>
        <th scope="col"></th>
        <th scope="col">Tipo</th>
        <th scope="col">Motivo</th>
        <th scope="col">Fecha</th>
        {% if request.user.is_staff %}
        <th scope="col">Carné</th>
        <th scope="col">Nombre</th>
        <th scope="col">Apellido</th>
        <th scope="col">Correo de estudiante</th>
        {% endif %}
        <th scope="col">Archivo Adjunto</th>
        <th scope="col">Estado</th>
        <th scope="col"></th>

      </tr>
    </thead>
    <tbody>
      {% for solicitud in solicitudes %}
        {% if not solicitud.enPapelera %}
          <tr>
            <td><input type="checkbox" name="inputs"  value="{{solicitud.id}}"/></td>
            <td>{{ solicitud.get_tipo_display }}</td>

            <td>{{ solicitud.motivo }}</td>
            <td>{{ solicitud.fecha }}</td>
            {% if request.user.is_staff %}
            <td>{{ solicitud.estudiante.user.username}}</td>
            <td>{{ solicitud.estudiante.user.first_name}}</td>
            <td>{{ solicitud.estudiante.user.last_name}}</td>


            <td>{{ solicitud.estudiante.user.email}}</td>
            {% endif %}
            <td>
              {% for archivo in archivos %}
                    
                      {% if archivo.solicitud_id == solicitud.id %} 
                            {{ archivo.archivo}}<br/>
                        {% endif %}
                    
                      
              {% endfor %}
            </td>
            <td>{{ solicitud.get_estado_display}}</td>
            <td style="text-align: center">
              <div >
                <a id="actionButtons"  href="editar_solicitud/{{ solicitud.id }}"class="btn btn-info" role="button">
                  <img  id="imageButtons" src="{% static '/svg/file-edit-line.svg' %}" />
                </a>
                <button onclick="return confirm('Está seguro de borrar?')" id="actionButtons" type="submit" style="background-color:crimson;" class="btn btn-info"  value="{{ solicitud.id }}"  name="deleteButton">             
                  <img id="imageButtons" src="{% static '/svg/delete-bin-line.svg' %}" />
                </button>
              </div>
            </td>
          </tr>

        {% endif %}
      {% endfor %}
  </tbody>
    </table>
  </div>
    {% else %}
         <strong>No hay solicitudes creadas</strong>
    {% endif %}
</form>
</div>


{% endblock %}
