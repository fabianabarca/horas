{% extends 'base.html' %} {% load crispy_forms_tags %} {% block main %}
{% load static %}


<script>
  var formSubmitting = false;
  var setFormSubmitting = function() { formSubmitting = true; };
  
  window.onload = function() {
      window.addEventListener("beforeunload", function (e) {
          if (formSubmitting) {
              return undefined;
          }
  
          var confirmationMessage = 'It looks like you have been editing something. '
                                  + 'If you leave before saving, your changes will be lost.';
          
          (e || window.event).returnValue = confirmationMessage; //Gecko + IE
          return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.
      });
  };
  </script>

<script  type="text/javascript">
  function confirmarRegistro(){
    var creacion =  confirm('¿Está seguro/a de que desea crear el registro?');
    if(creacion){
      const collection = document.getElementsByClassName("alert alert-success");

      collection[0].setAttribute("style", "display:block");
    }
    
    return creacion
  }
</script>


<div class="container">
  <div class="alert alert-success" role="alert" style="display:none">
    <i class="material-icons">done</i> El registro de tarea se ha realizado exitosamente.
  </div>
</br>
{% if tipoAccion %}
  <h1>Crear Tarea</h1>
{% else %}
  <h1>Editar Tarea</h1>
{% endif %}

<form method="post" onsubmit="setFormSubmitting()" id="tareasForm" data-objetivos-url="{% url 'load_objetivos' %}">
    {% csrf_token %}
    <input type="hidden" name="next" value="{{ next }}" />

    {{tarea_form|crispy }}
    
   

    <button type="submit"  onClick = "return confirmarRegistro();" class="btn btn-primary btn-block">Continuar</button>
</form>
<!--Usando código modificado de https://github.com/akjasim/cb_dj_dependent_dropdown-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>
  $("#id_tareasuperior").change(function () {
      console.log("activado accion tarea");
      const url = $("#tareasForm").attr("data-objetivos-url");  // get the url of the `load_cities` view
      const tareaId = $(this).val();  // get the selected country ID from the HTML input

      $.ajax({                       // initialize an AJAX request
          url: url,                    // set the url of the request (= /persons/ajax/load-cities/ )
          data: {
              'tarea_id': tareaId       // add the country id to the GET parameters
          },
          success: function (data) {   // `data` is the return of the `load_cities` view function
              $("#id_objetivo").html(data);  // replace the contents of the city input with the data that came from the server
              

              let html_data = '<option value="">---------</option>';
              data.forEach(function (objetivo) {
                  html_data += `<option value="${objetivo.id}">${objetivo.name}</option>`
              });
              console.log(html_data);
              $("#id_objetivo").html(html_data);

            
          }
      });

  });
</script>


</div>



{% endblock %}
