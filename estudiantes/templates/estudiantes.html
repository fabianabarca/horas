{% extends 'base.html' %}

{% load static %}

{% load crispy_forms_tags %}

{% block page_title %} Estudiantes {% endblock %}

{% block main %}

<!-- Título -->
<div class="d-flex justify-content-between">
  <div>
    <h1 class="display-4">Estudiantes</h1>
  </div>
  <div>
    <h1><span class="badge text-bg-dark"><i class="cil-user"></i></span></h1>
  </div>
</div>

<!-- Descripción -->
<p class="lead">
  Lista de personas matriculadas y activas en TC-691 "Tropicalización de la tecnología".
</p>

{% if request.user.is_staff %}
<!-- Botón para agregar estudiantes -->
<p>
  <a href="{% url 'registro' %}" type="button" class="btn btn-outline-info">Nuevo estudiante</a>
</p>
{% endif %}

<br>

<!-- Lista de estudiantes activos -->
<h6 class="text-uppercase font-weight-bolder opacity-6">Lista de estudiantes activos</h6>

<form method="post">
  
  {% csrf_token %}
      
  {% if informacion %}
  
  <!-- Tabla -->
  <p>
  <div class="card">
    <div class="card-body">
      <!--Tabla de estudiantes-->
      <div class="table table-responsive">
        <table id="estudiantes-table" class="table align-items-center table-hover">
          <thead>
            <tr>
              {% if request.user.is_staff %}
              <th scope="col" class="text-center"><i class="icon cil-user"></i></th>
              {% endif %}
              <th scope="col"><i class="icon cil-envelope-letter"></i></th>
              {% if request.user.is_staff %}
              <th scope="col">Carné</th>
              {% endif %}
              <th scope="col">Nombre</th>
              <th scope="col">Carrera</th>
              <th scope="col">Finalización</th>
              <th scope="col" class="text-center"><i class="icon cil-contact"></i></th>
              {% if request.user.is_staff %}
              <th scope="col">Progreso</th>
              {% endif %}
            </tr>
          </thead>
          <tbody>
            {% for estudiante, horas, porcentaje, porcentajeWidth in informacion %}
            <tr>
              <!-- Información -->
              {% if request.user.is_staff %}
              <td scope="col" class="text-center">
                <!-- A pagina de estudiante button
                <button  class="text-info"  value="{{ estudiante.user.id }}" name="studentButton" type="submit">
                  <i class="	fa fa-address-card"></i>
                </button> -->
                <!--
                <a  class="text-info"  href="/index/{{estudiante.id }}" role="button">
                  <i class="	fa fa-address-card"></i>
                </a>
                -->              
                <!-- Información -->
                <a href="{{ estudiante.user.username }}" style="text-decoration: none;">
                  <i class="icon cil-bar-chart text-success"></i>
                </a>               
              </td>
              {% endif %}
              <!-- Correo electrónico -->
              <td>
                <!-- Correo -->
                <a href="mailto:{{ estudiante.user.email }}" target="_blank" style="text-decoration: none;">
                  <i class="icon cil-at text-info"></i>
                </a>
              </td>
              {% if request.user.is_staff %}
              <!-- ID -->
              <td>{{ estudiante.user.username }}</td>
              {% endif %}
              <!-- Nombre -->
              <td>{{ estudiante.user.first_name }} {{ estudiante.user.last_name }}</span></td>
              <!-- Carrera -->
              <td>{{ estudiante.carrera.nombre }}</td>
              <!-- Finalización -->
              <td>{{ estudiante.fecha_final|date:"j b Y" }}</td>
              <!-- Tutor -->
              <td class="text-center">
                <span class="small">
                  <span class="badge rounded-pill text-bg-secondary">
                    {% if estudiante.tutor.user.username == 'fabian' %}
                    FAC
                    {% elif estudiante.tutor.user.username == 'teodoro' %}
                    TWC
                    {% elif estudiante.tutor.user.username == 'helber' %}
                    HMN
                    {% elif estudiante.tutor.user.username == 'david' %}
                    DMR
                    {% else %}
                    N/A
                    {% endif %}
                  </span>
                </span>
              </td>
              {% if request.user.is_staff %}
              <!-- Horas -->
              <td>
                <span class="small">{{ horas }} de 300 <span class="text-muted">({{ porcentaje }}%)</span></span>
                <div class="progress progress-thin">
                  <div class="progress-bar bg-warning" role="progressbar" style="width: {{ porcentajeWidth }}%" aria-valuenow="{{ porcentajeWidth }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </td>
              {% endif %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  </p>

 
  {% else %}
  <div class="alert alert-info" role="alert">
    No hay estudiantes activos registrados.
  </div>
  {% endif %}

  {% if request.user.is_staff %}

  {% if finalizados %}
  <h6 class="text-uppercase font-weight-bolder opacity-6">Lista de estudiantes finalizados</h6>
  <p>
    <div class="card">
      <div class="card-body">
        <!--Tabla de estudiantes finalizados-->
        <div class="table table-responsive">
          <table id="estudiantes-finalizados-table" class="table align-items-center table-hover">
            <thead>
              <tr>
                <th scope="col" class="text-center"><i class="icon cil-user"></i></th>
                <th scope="col"><i class="icon cil-envelope-letter"></i></th>
                <th scope="col">Carné</th>
                <th scope="col">Nombre</th>
                <th scope="col">Carrera</th>
                <th scope="col">Finalización</th>
                <th scope="col" class="text-center"><i class="icon cil-contact"></i></th>              
              </tr>
            </thead>
            <tbody>
              {% for estudianteFinalizado in finalizados%}
              <tr>
                <!-- Información -->
                <td scope="col" class="text-center">
                  <!-- A pagina de estudiante button
                  <button  class="text-info"  value="{{ estudiante.user.id }}" name="studentButton" type="submit">
                    <i class="	fa fa-address-card"></i>
                  </button> -->
                  <!--
                  <a  class="text-info"  href="/index/{{estudiante.id }}" role="button">
                    <i class="	fa fa-address-card"></i>
                  </a>
                  -->              
                  <!-- Información -->
                  <a href="{{ estudianteFinalizado.user.username }}" style="text-decoration: none;">
                    <i class="icon cil-bar-chart text-success"></i>
                  </a>               
                </td>
                <!-- Correo electrónico -->
                <td>
                  <!-- Correo -->
                  <a href="mailto:{{ estudianteFinalizado.user.email }}" target="_blank" style="text-decoration: none;">
                    <i class="icon cil-at text-info"></i>
                  </a>
                </td>
          
                <!-- ID -->
                <td>{{ estudianteFinalizado.user.username }}</td>
               
                <!-- Nombre -->
                <td>{{ estudianteFinalizado.user.first_name }} {{ estudianteFinalizado.user.last_name }}</span></td>
                <!-- Carrera -->
                <td>{{ estudianteFinalizado.carrera.nombre }}</td>
                <!-- Finalización -->
                <td>{{ estudianteFinalizado.fecha_final|date:"j b Y" }}</td>
                <!-- Tutor -->
                <td class="text-center">
                  <span class="small">
                    <span class="badge rounded-pill text-bg-secondary">
                      {% if estudianteFinalizado.tutor.user.username == 'fabian' %}
                      FAC
                      {% elif estudianteFinalizado.tutor.user.username == 'teodoro' %}
                      TWC
                      {% elif estudianteFinalizado.tutor.user.username == 'helber' %}
                      HMN
                      {% elif estudianteFinalizado.tutor.user.username == 'david' %}
                      DMR
                      {% else %}
                      N/A
                      {% endif %}
                    </span>
                  </span>
                </td>
               
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    </p>
    {% else %}
    <p>No hay estudiantes finalizados</p>
    {% endif %}

    {% if otrosEstados %}
    <h6 class="text-uppercase font-weight-bolder opacity-6">Lista de estudiantes en otros estados</h6>
    
    <p>
      <div class="card">
        <div class="card-body">
          <!--Tabla de estudiantes en otros estados-->
          <div class="table table-responsive">
            <table id="estudiantes-otros-estados-table" class="table align-items-center table-hover">
              <thead>
                <tr>
                  <th scope="col" class="text-center"><i class="icon cil-user"></i></th>
                  <th scope="col"><i class="icon cil-envelope-letter"></i></th>
                  <th scope="col">Carné</th>
                  <th scope="col">Nombre</th>
                  <th scope="col">Carrera</th>
                  <th scope="col">Finalización</th>
                  <th scope="col">Estado</th>
                  <th scope="col" class="text-center"><i class="icon cil-contact"></i></th>
                  
                </tr>
              </thead>
              <tbody>

                {% for estudianteOtroEstado in otrosEstados%}
               
                <tr>
                  <!-- Información -->
                  <td scope="col" class="text-center">
                    <!-- A pagina de estudiante button
                    <button  class="text-info"  value="{{ estudiante.user.id }}" name="studentButton" type="submit">
                      <i class="	fa fa-address-card"></i>
                    </button> -->
                    <!--
                    <a  class="text-info"  href="/index/{{estudiante.id }}" role="button">
                      <i class="	fa fa-address-card"></i>
                    </a>
                    -->              
                    <!-- Información -->
                    <a href="{{ estudianteOtroEstado.user.username }}" style="text-decoration: none;">
                      <i class="icon cil-bar-chart text-success"></i>
                    </a>               
                  </td>
                  <!-- Correo electrónico -->
                  <td>
                    <!-- Correo -->
                    <a href="mailto:{{ estudianteOtroEstado.user.email }}" target="_blank" style="text-decoration: none;">
                      <i class="icon cil-at text-info"></i>
                    </a>
                  </td>
            
                  <!-- ID -->
                  <td>{{ estudianteOtroEstado.user.username }}</td>
                 
                  <!-- Nombre -->
                  <td>{{ estudianteOtroEstado.user.first_name }} {{ estudianteFinalizado.user.last_name }}</span></td>
                  <!-- Carrera -->
                  <td>{{ estudianteOtroEstado.carrera.nombre }}</td>
                  <!-- Finalización -->
                  <td>{{ estudianteOtroEstado.fecha_final|date:"j b Y" }}</td>
                  <!--Estado-->
                  <td>{{ estudianteOtroEstado.estado }}</td>
                  <!-- Tutor -->
                  <td class="text-center">
                    <span class="small">
                      <span class="badge rounded-pill text-bg-secondary">
                        {% if estudianteOtroEstado.tutor.user.username == 'fabian' %}
                        FAC
                        {% elif estudianteOtroEstado.tutor.user.username == 'teodoro' %}
                        TWC
                        {% elif estudianteOtroEstado.tutor.user.username == 'helber' %}
                        HMN
                        {% elif estudianteOtroEstado.tutor.user.username == 'david' %}
                        DMR
                        {% else %}
                        N/A
                        {% endif %}
                      </span>
                    </span>
                  </td>
                 
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      </p>  
      {% else %}
      <br/>
      <p>No hay estudiantes en otros estados</p>
      {% endif %}
  {% endif %}

</form>

<!-- Sobre profesores tutores -->
<p>
  Cada estudiante tiene asignado un docente tutor, indicado como 
  <span class="small"><span class="badge small rounded-pill text-bg-secondary">FAC</span></span> Fabián, 
  <span class="small"><span class="badge rounded-pill text-bg-secondary">HMN</span></span> Helber, 
  <span class="small"><span class="badge rounded-pill text-bg-secondary">DMR</span></span> David y 
  <span class="small"><span class="badge rounded-pill text-bg-secondary">TWC</span></span> Teodoro.
</p>

{% endblock %}